<html>

	<head>
		<title>comet demo</title>

		<style type="text/css">
			div#chat {
				width: 800px;
				height: 400px;
				border: 1px solid black;
				overflow: scroll;
			}
			input#line {
				width: 400px;
			}

		</style>
		<script type="text/javascript" src="http://river.test.com:1234/lib.js?domain=test.com"></script>
	</head>
<body>
	<script type="text/javascript">

		document.domain = "test.com";
		/*
		total = 0;
		function notice(text) {
		}

		function onMsg(obj) {
			total++;
			var chat = document.getElementById("chat");
			chat .innerHTML += "<br/>("+total+") received ["+obj.data+"] with sequence number ["+obj.seq+"]";
			chat.scrollTop = chat.scrollHeight;
		}
		*/
		var c = null;

		document.domain = "test.com";

		function onMsg(msg) {
			console.log("received message: ", msg);
		}

		function comet() {
			Comet.init(function() {
				c = new Comet.Client();
				c.connect("public-channel", onMsg); // call onMsg upon reception of a message.
			});
		}
/*
		function comet() {
			var log = document.getElementById("log");
			try {
				var iframe = document.getElementById("iframe").contentWindow;
				c = new iframe.CometClient("cometd.test.com:1234");
				c.connect("public-channel", onMsg);
				log.innerHTML = "CONNECTED.";
				log.setAttribute("style", "color: #0a0;");
			} catch(e) {
				log.innerHTML = "FAILED TO CONNECT. check that cometd is running on cometd.test.com:1234.";
				log.setAttribute("style", "color: #c00;");
			}
		}

		function disconnect() {
			c.disconnect();
		}
		*/

		function sendMsg(e) {

			if(e.keyCode != 13) {
				return true;
			}

			var line = document.getElementById("line");
			var msg = line.value;

			c.send("public-channel", msg);
			line.value = "";
		}
	</script>
	
	<button onclick="comet();">connect</button>
	<button onclick="disconnect();">disconnect</button>
	
	<div id="log"></div>
	<div id="chat"></div>
	<input onKeyPress="sendMsg(event);" id="line" />
	
</body>
</html>
